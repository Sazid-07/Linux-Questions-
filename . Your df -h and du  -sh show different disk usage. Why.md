 **df -h** and **du / dush** difference is one of the MOST common real-time confusion in Linux.
Production me 90% admins isme fas jaate hain â€” so let me explain in *pure real-time style* with **actual reasons + how to identify the exact culprit**.

---

# âœ… **Why `df -h` and `du` / `dush` Show Different Disk Usage**

## **Simple Answer (Real-Time Admin Style)**

* **df -h** â†’ filesystem level space usage (from *block layer*).
* **du / dush** â†’ directory/file level usage (from *user-space directory tree*).

Iska matlab:

> **df -h = actual disk blocks used**
> **du = actual visible files ka size**

Isliye dono **kabhi bhi perfectly match nahi honge**.

---

# ğŸ§¨ **Top 6 Real-Time Reasons for Difference (with examples)**

---

## **1ï¸âƒ£ Deleted files still held by running processes**

ğŸ‘‰ **MOST COMMON issue in Production**

**Scenario:**
A 10GB log file removed:

```bash
rm /var/log/app.log
```

But application is still writing to it â†’ inode open hai.

### `df -h` shows:

Space **still occupied** because data is still on disk.

### `du` shows:

File deleted â†’ **0 bytes** (or small size).

### ğŸ” How to confirm:

```bash
lsof | grep deleted
```

You will see something like:

```
app   1234   root   5u   REG deleted /var/log/app.log
```

ğŸ‘‰ **Fix:** restart application or truncate the open file:

```bash
: > /proc/1234/fd/5
```

---

## **2ï¸âƒ£ Mount point overlay (mount hiding actual files)**

**Scenario:**
Before mounting:

```
/data/    â†’ contains 5GB old files
```

Then you mount SAN/NFS:

```bash
mount /dev/sdb1 /data
```

Now:

* **df -h â†’ shows mounted disk (example 500GB)**
* **du /data â†’ shows new empty directory**

But the old 5GB which was earlier **under the original /data** is still counted by df but **hidden from du**.

### ğŸ” Check hidden files:

Unmount and check:

```bash
umount /data
ls -lh /data
```

---

## **3ï¸âƒ£ Sparse files (logical size â‰  physical size)**

Example: VM images, database files.

### `du` shows:

Large logical size â†’ e.g., 100GB file

### `df` actual usage:

Maybe only 5GB used on disk.

### ğŸ” Check:

```bash
du -h vm.img
du -h --apparent-size vm.img
```

---

## **4ï¸âƒ£ Hard links**

Hard link file ka size `du` double count nahi karta.
But `df` blocks count karta hai.

Example:

```bash
ln /bigfile /anotherplace/bigfile
```

Disk blocks = same
`du` may show different directory-wise usage.

---

## **5ï¸âƒ£ Files in special FS (tmpfs, overlayfs, docker layers)**

Example: `/var/lib/docker`, container layers.

* df shows physical FS usage
* du shows layered FS usage (sometimes lesser/greater)

---

## **6ï¸âƒ£ Reserved blocks (EXT4 reserve for root)**

EXT4 reserves 5% blocks for root.

* `df -h` shows less available space
* `du` doesnâ€™t count reserved blocks at all.

Check reserved blocks:

```bash
tune2fs -l /dev/sda1 | grep -i reserve
```

---

# ğŸ”¥ **Most Real-Time Practical Reason**

**Deleted log files still held open by process (Reason #1)**
Production me almost **80% cases** yahi hota hai.

---

# ğŸ§ª Example in Real-Time

Your `df -h` shows:

```
Filesystem      Size  Used  Avail
/dev/sda2        40G   37G   3G
```

But your `dush /var` shows:

```
/var  â†’ 25G only
```

Where is remaining 12G?
â†’ Deleted log files still being used.

### Identify:

```bash
lsof | grep deleted
```

Output:

```
nginx  5432  deleted  /var/log/nginx/access.log
```

---

# ğŸ”š **Buddy Summary (Revision Points)**

| Tool          | What it measures   | Layer                  | Common issue                 |
| ------------- | ------------------ | ---------------------- | ---------------------------- |
| **df -h**     | Disk blocks used   | Kernel FS layer        | deleted but open files       |
| **du / dush** | Visible files size | User-space directories | mount overlays, sparse files |

---

# ğŸ¯ Real-Time Admin Check-List

When df â‰  du:

1. Check deleted but open files

   ```
   lsof | grep deleted
   ```
2. Check hidden files under mount directory

   ```
   umount /path
   ```
3. Check sparse files
4. Check docker storage
5. Check filesystem reserved blocks
